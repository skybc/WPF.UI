<!--
    This Source Code Form is subject to the terms of the MIT License.
    If a copy of the MIT was not distributed with this file, You can obtain one at https://opensource.org/licenses/MIT.
    Copyright (C) Leszek Pomianowski and WPF UI Contributors.
    All Rights Reserved.
-->

<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:Wpf.Ui.Controls"
    xmlns:coverter="clr-namespace:Wpf.Ui.Converters"
    xmlns:local="clr-namespace:Wpf.Ui.Controls"
    xmlns:system="clr-namespace:System;assembly=System.Runtime">

    <!--  Step 大小常量  -->
    <system:Double x:Key="StepCircleSize">32</system:Double>
    <system:Double x:Key="StepLineThickness">2</system:Double>
    <coverter:AddOneConverter x:Key="AddOneConverter" />
    <coverter:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />

    <!--  Step 默认样式 - 支持水平和垂直布局  -->
    <Style TargetType="{x:Type controls:Step}">
        <Setter Property="Background" Value="Transparent" />
        <Setter Property="Foreground" Value="{DynamicResource TextFillColorPrimaryBrush}" />
        <Setter Property="Cursor" Value="Hand" />
        <Setter Property="OverridesDefaultStyle" Value="True" />
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="{x:Type controls:Step}">
                    <!--  主容器 - 水平布局为竖向，垂直布局为横向  -->
                    <StackPanel x:Name="RootPanel" Orientation="Vertical">
                        <Grid x:Name="CircleGrid" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <!--  步骤圆圈  -->
                            <Border
                                x:Name="StepCircle"
                                Grid.Column="0"
                                Width="{StaticResource StepCircleSize}"
                                Height="{StaticResource StepCircleSize}"
                                VerticalAlignment="Center"
                                Background="{DynamicResource ControlAltFillColorSecondaryBrush}"
                                BorderBrush="{DynamicResource ControlElevationBorderBrush}"
                                CornerRadius="16">
                                <TextBlock
                                    x:Name="StepIndex"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    FontSize="14"
                                    FontWeight="SemiBold"
                                    Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                    Text="{Binding Index, RelativeSource={RelativeSource TemplatedParent}, Converter={StaticResource AddOneConverter}, ConverterParameter=0}" />
                            </Border>

                            <!--  连接线（水平方向）  -->
                            <Border
                                x:Name="ConnectorLine"
                                Grid.Column="1"
                                Height="{StaticResource StepLineThickness}"
                                MinWidth="20"
                                Margin="16,0,0,0"
                                HorizontalAlignment="Stretch"
                                VerticalAlignment="Center"
                                Background="{DynamicResource ControlElevationBorderBrush}" />
                        </Grid>

                        <!--  标题和描述  -->
                        <StackPanel x:Name="TextContent" HorizontalAlignment="Left">
                            <TextBlock
                                Margin="0,0,0,4"
                                FontSize="12"
                                FontWeight="SemiBold"
                                Foreground="{DynamicResource TextFillColorPrimaryBrush}"
                                Text="{TemplateBinding Title}"
                                TextAlignment="Center"
                                TextWrapping="Wrap" />
                            <TextBlock
                                FontSize="11"
                                Foreground="{DynamicResource TextFillColorSecondaryBrush}"
                                Text="{TemplateBinding Description}"
                                TextAlignment="Center"
                                TextWrapping="Wrap"
                                Visibility="{TemplateBinding Description,
                                                             Converter={StaticResource BoolToVisibilityConverter}}" />
                        </StackPanel>

                        <!--  垂直布局中的竖向连接线（在左边圆圈下方）  -->
                        <Border
                            x:Name="VerticalConnectorLine"
                            Width="{StaticResource StepLineThickness}"
                            Height="32"
                            Margin="15,0,0,0"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Top"
                            Background="{DynamicResource ControlElevationBorderBrush}"
                            Visibility="Collapsed" />
                    </StackPanel>

                    <ControlTemplate.Triggers>
                        <!--  等待状态 - 更新竖线颜色  -->
                        <Trigger Property="Status" Value="Wait">
                            <Setter TargetName="StepCircle" Property="Background" Value="{DynamicResource ControlAltFillColorSecondaryBrush}" />
                            <Setter TargetName="StepCircle" Property="BorderBrush" Value="{DynamicResource ControlElevationBorderBrush}" />
                            <Setter TargetName="ConnectorLine" Property="Background" Value="{DynamicResource ControlElevationBorderBrush}" />
                            <Setter TargetName="VerticalConnectorLine" Property="Background" Value="{DynamicResource ControlElevationBorderBrush}" />
                        </Trigger>

                        <!--  进行中状态 - 更新竖线颜色  -->
                        <Trigger Property="Status" Value="Process">
                            <Setter TargetName="StepCircle" Property="Background" Value="{DynamicResource AccentFillColorDefaultBrush}" />
                            <Setter TargetName="StepCircle" Property="BorderBrush" Value="{DynamicResource AccentFillColorDefaultBrush}" />
                            <Setter TargetName="StepIndex" Property="Text" Value="●" />
                            <Setter TargetName="StepIndex" Property="FontSize" Value="16" />
                            <Setter TargetName="StepIndex" Property="Foreground" Value="White" />
                            <Setter TargetName="ConnectorLine" Property="Background" Value="{DynamicResource ControlElevationBorderBrush}" />
                            <Setter TargetName="VerticalConnectorLine" Property="Background" Value="{DynamicResource ControlElevationBorderBrush}" />
                        </Trigger>

                        <!--  完成状态 - 更新竖线颜色  -->
                        <Trigger Property="Status" Value="Finish">
                            <Setter TargetName="StepCircle" Property="Background" Value="{DynamicResource SystemFillColorSuccessBrush}" />
                            <Setter TargetName="StepCircle" Property="BorderBrush" Value="{DynamicResource SystemFillColorSuccessBrush}" />
                            <Setter TargetName="StepIndex" Property="Text" Value="✓" />
                            <Setter TargetName="StepIndex" Property="FontSize" Value="14" />
                            <Setter TargetName="StepIndex" Property="Foreground" Value="White" />
                            <Setter TargetName="StepIndex" Property="FontWeight" Value="Bold" />
                            <Setter TargetName="ConnectorLine" Property="Background" Value="{DynamicResource SystemFillColorSuccessBrush}" />
                            <Setter TargetName="VerticalConnectorLine" Property="Background" Value="{DynamicResource SystemFillColorSuccessBrush}" />
                        </Trigger>

                        <!--  错误状态 - 更新竖线颜色  -->
                        <Trigger Property="Status" Value="Error">
                            <Setter TargetName="StepCircle" Property="Background" Value="{DynamicResource ErrorFillColorDefaultBrush}" />
                            <Setter TargetName="StepCircle" Property="BorderBrush" Value="{DynamicResource ErrorFillColorDefaultBrush}" />
                            <Setter TargetName="StepIndex" Property="Text" Value="✕" />
                            <Setter TargetName="StepIndex" Property="FontSize" Value="14" />
                            <Setter TargetName="StepIndex" Property="Foreground" Value="White" />
                            <Setter TargetName="StepIndex" Property="FontWeight" Value="Bold" />
                            <Setter TargetName="ConnectorLine" Property="Background" Value="{DynamicResource ErrorFillColorDefaultBrush}" />
                            <Setter TargetName="VerticalConnectorLine" Property="Background" Value="{DynamicResource ErrorFillColorDefaultBrush}" />
                        </Trigger>

                        <!--  不可点击时  -->
                        <Trigger Property="IsClickable" Value="False">
                            <Setter Property="Cursor" Value="Arrow" />
                        </Trigger>

                        <!--  禁用状态  -->
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter TargetName="StepCircle" Property="Opacity" Value="0.6" />
                            <Setter Property="Opacity" Value="0.6" />
                        </Trigger>

                        <!--  鼠标悬停时可点击的步骤的样式  -->
                        <!--<MultiTrigger>
                            <MultiTrigger.Conditions>
                                <Condition Property="IsClickable" Value="True" />
                                <Condition Property="IsMouseOver" Value="True" />
                            </MultiTrigger.Conditions>
                            <Setter TargetName="StepCircle" Property="Background" Value="{DynamicResource ControlFillColorDefaultBrush}" />
                        </MultiTrigger>-->

                        <!--  隐藏水平布局中最后一步的连接线  -->
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=controls:Steps}, Path=Orientation}" Value="Horizontal" />
                                <Condition Binding="{Binding RelativeSource={RelativeSource Self}, Path=(local:Steps.IsLastStep)}" Value="True" />
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="ConnectorLine" Property="Visibility" Value="Collapsed" />
                        </MultiDataTrigger>

                        <!--  垂直布局时的调整 - 使圆圈+竖线在左，标题描述在右  -->
                        <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=controls:Steps}, Path=Orientation}" Value="Vertical">
                            <Setter TargetName="RootPanel" Property="Orientation" Value="Horizontal" />
                            <Setter TargetName="CircleGrid" Property="Margin" Value="0,0,12,0" />
                            <Setter TargetName="CircleGrid" Property="VerticalAlignment" Value="Top" />
                            <Setter TargetName="ConnectorLine" Property="Visibility" Value="Collapsed" />
                            <Setter TargetName="TextContent" Property="HorizontalAlignment" Value="Stretch" />
                            <Setter TargetName="TextContent" Property="VerticalAlignment" Value="Top" />
                            <Setter TargetName="VerticalConnectorLine" Property="Visibility" Value="Visible" />
                        </DataTrigger>

                        <!--  垂直布局中最后一步隐藏连接线  -->
                        <MultiDataTrigger>
                            <MultiDataTrigger.Conditions>
                                <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=controls:Steps}, Path=Orientation}" Value="Vertical" />
                                <Condition Binding="{Binding RelativeSource={RelativeSource Self}, Path=(local:Steps.IsLastStep)}" Value="True" />
                            </MultiDataTrigger.Conditions>
                            <Setter TargetName="ConnectorLine" Property="Visibility" Value="Collapsed" />
                            <Setter TargetName="VerticalConnectorLine" Property="Visibility" Value="Collapsed" />
                        </MultiDataTrigger>
                    </ControlTemplate.Triggers>
                </ControlTemplate>
            </Setter.Value>
        </Setter>

        <!--  根据方向设置对齐方式和边距  -->
        <Style.Triggers>
            <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=controls:Steps}, Path=Orientation}" Value="Vertical">
                <Setter Property="HorizontalAlignment" Value="Stretch" />
                <Setter Property="VerticalAlignment" Value="Top" />
                <Setter Property="Margin" Value="0,8,0,8" />
            </DataTrigger>
            <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=controls:Steps}, Path=Orientation}" Value="Horizontal">
                <Setter Property="HorizontalAlignment" Value="Center" />
                <Setter Property="VerticalAlignment" Value="Center" />
                <Setter Property="Margin" Value="8,0,8,0" />
            </DataTrigger>
        </Style.Triggers>
    </Style>

</ResourceDictionary>
